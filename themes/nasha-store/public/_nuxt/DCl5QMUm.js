import{a7 as de,a8 as pe,a9 as fe,d as _e,x as ge,y as he,u as ve,X as ye,Y as be,s as b,T as we,H as ke,o as c,c as m,e,g as N,n as xe,F as w,b as a,f as Se,i as t,t as u,w as f,j as D,k as $e,l as Ae,Z as Ve,p as De,$ as h,a0 as T,a1 as Ce,h as d,a2 as L,a3 as R,a4 as Z,a5 as Me}from"./D2h1M-6X.js";import{_ as Ee}from"./DvU2Yq2X.js";import{u as Ie,l as Ne,_ as Te,a as Ue,b as Pe,c as Be,d as Oe,e as je}from"./CsQFPYKN.js";import{u as ze}from"./hrPMgQTE.js";import{_ as qe,a as Ge,b as Le}from"./DmHgsjQb.js";import"./GQHXd0SH.js";import"./CTsXp8GV.js";import"./DM4cFtrS.js";import"./5Eo_AKUy.js";import"./Bk_rJcZu.js";function Re(){const C=de(pe,null);return C===null&&fe("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),C}const Ze={class:"flex flex-col h-full"},Ke={key:0,class:"flex flex-col items-center justify-center flex-1 mb-12"},Ye={class:"text-2xl font-bold mb-2"},Fe={class:"text-gray-400 mb-4"},He={class:"sticky top-0 myglass flex items-center justify-center py-2"},Qe={class:"grid w-full my-2 max-w-2xl gap-8 checkout-form flex-1"},Xe={key:0},Je={class:"w-full my-2 text-2xl font-semibold leading-none"},We={class:"mt-1 text-sm text-gray-500"},es={href:"/my-account",class:"text-primary text-semibold"},ss={class:"w-full mt-4"},ts={for:"email"},os={key:0,class:"mt-1 text-sm text-red-500"},ns={class:"w-full mt-4"},as={for:"username"},ls={key:0,class:"w-full my-2"},is={for:"email"},rs={key:1,class:"flex items-center gap-2 my-2"},us={for:"creat-account"},cs={class:"w-full mb-3 text-2xl font-semibold"},ms={key:0,for:"shipToDifferentAddress",class:"flex items-center gap-2"},ds={class:"mb-4 text-xl font-semibold"},ps={key:1},fs={class:"mb-4 text-xl font-semibold"},_s={key:0,class:"mt-2 col-span-full"},gs={class:"mb-4 text-xl font-semibold"},hs={class:"mb-4 text-xl font-semibold"},vs=["placeholder"],ys=["disabled"],bs={class:"sticky bottom-0"},Ns=_e({__name:"checkout1",async setup(C){var q;let k,U;const{t:_}=ge(),{query:ws}=he(),{cart:v,isUpdatingCart:K,paymentGateways:P}=ve(),{customer:l,viewer:M}=ye(),{orderInput:n,isProcessingOrder:E,proccessCheckout:Y}=Ie(),B=((q=be().public)==null?void 0:q.STRIPE_PUBLISHABLE_KEY)||null,I=b(E.value?_("messages.general.processing"):_("messages.shop.checkoutButton")),F=we(()=>E.value||K.value||!n.value.paymentMethod),x=Re(),y=b(!1),S=B?([k,U]=ke(()=>Ne(B)),k=await k,U(),k):null;let O=b(null);const j=b(!1),H=async()=>{var s;I.value=_("messages.general.processing");try{const{stripePaymentIntent:o}=await Ve(),{clientSecret:$}=o;if(n.value.paymentMethod.id==="stripe"){const A=O.value.getElement("card"),{setupIntent:g}=await S.confirmCardSetup($,{payment_method:{card:A}}),{source:p}=await S.createSource(A);p&&n.value.metaData.push({key:"_stripe_source_id",value:p.id}),g&&n.value.metaData.push({key:"_stripe_intent_id",value:g.id}),j.value=(g==null?void 0:g.status)==="succeeded"||!1,n.value.transactionId=((s=p==null?void 0:p.created)==null?void 0:s.toString())||new Date().getTime().toString()}}catch(o){console.error(o),I.value=_("messages.shop.placeOrder")}Y(j.value)},Q=s=>{O.value=s},z=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/,X=s=>{s&&(y.value=!z.test(s))},J=s=>{s&&y.value&&(y.value=!z.test(s))};ze({title:_("messages.shop.checkout")});const i=b(M.value?2:1),W=b("process");function ee(){var s;if(i.value===1&&(!l.value.billing.email||y.value))return x.error(_("messages.error.invalidEmail")),!1;if(i.value===2){if(!((s=l.value.billing)!=null&&s.firstName)||!l.value.billing.lastName||!l.value.billing.address1||!l.value.billing.city||!l.value.billing.postcode||!l.value.billing.country)return x.error(_("messages.error.missingBillingDetails")),!1;if(n.shipToDifferentAddress&&(!l.value.shipping.firstName||!l.value.shipping.lastName||!l.value.shipping.address1||!l.value.shipping.city||!l.value.shipping.postcode||!l.value.shipping.country))return x.error(_("messages.error.missingShippingDetails")),!1}return i.value===3&&(!n.value.paymentMethod||!n.value.paymentMethod.id)?(x.error(_("messages.error.missingPaymentMethod")),!1):!0}function se(){ee()&&(i.value===null?i.value=1:i.value>=4?i.value=null:i.value++)}function te(){i.value===0?i.value=null:i.value===null?i.value=4:i.value--}return(s,o)=>{const $=xe,A=Se,g=$e,p=De,V=qe,oe=Ge,ne=Ee,ae=Te,le=Ue,ie=Pe,re=Be,ue=Oe,ce=je,G=Me,me=Le;return c(),m("div",Ze,[e(v)?(c(),m(w,{key:1},[e(v).isEmpty?(c(),m("div",Ke,[a(A,{name:"ion:cart-outline",size:"156",class:"opacity-25 mb-5"}),t("h2",Ye,u(s.$t("messages.shop.cartEmpty")),1),t("span",Fe,u(s.$t("messages.shop.addProductsInYourCart")),1),a(g,{to:"/products",class:"flex items-center justify-center gap-3 p-2 px-3 mt-4 font-semibold text-center text-white rounded-lg shadow-md bg-primary hover:bg-primary-dark"},{default:f(()=>[D(u(s.$t("messages.shop.browseOurProducts")),1)]),_:1})])):(c(),m("form",{key:1,class:"mx-4 flex-1 flex flex-col h-full relative",onSubmit:Ae(H,["prevent"])},[t("div",He,[a(oe,{class:"ml-8",current:e(i),status:e(W)},{default:f(()=>[a(V,null,{icon:f(()=>[a(p,{icon:"ion:home",class:"text-white"})]),_:1}),a(V,null,{icon:f(()=>[a(p,{icon:"ion:person"})]),_:1}),a(V,null,{icon:f(()=>[a(p,{icon:"ion:card"})]),_:1}),a(V,null,{icon:f(()=>[a(p,{icon:"ion:checkmark-circle"})]),_:1})]),_:1},8,["current","status"])]),t("div",Qe,[!e(M)&&e(i)==1?(c(),m("div",Xe,[t("h2",Je,u(s.$t("messages.account.emailOrUsername")),1),t("p",We,[D(u(s.$t("messages.account.hasAccount"))+" ",1),t("a",es,u(s.$t("messages.account.login")),1),o[11]||(o[11]=D("."))]),t("div",ss,[t("label",ts,u(s.$t("messages.billing.email")),1),h(t("input",{"onUpdate:modelValue":o[0]||(o[0]=r=>e(l).billing.email=r),placeholder:"johndoe@email.com",type:"email",name:"email",class:Ce({"has-error":e(y)}),onBlur:o[1]||(o[1]=r=>X(e(l).billing.email)),onInput:o[2]||(o[2]=r=>J(e(l).billing.email)),required:""},null,34),[[T,e(l).billing.email]]),a(L,{name:"scale-y",mode:"out-in"},{default:f(()=>[e(y)?(c(),m("div",os,u(s.$t("messages.error.general")),1)):d("",!0)]),_:1})]),e(n).createAccount?(c(),m(w,{key:0},[t("div",ns,[t("label",as,u(s.$t("messages.account.username")),1),h(t("input",{"onUpdate:modelValue":o[3]||(o[3]=r=>e(n).username=r),placeholder:"Username",type:"text",name:"username",required:""},null,512),[[T,e(n).username]])]),e(n).createAccount?(c(),m("div",ls,[t("label",is,u(s.$t("messages.account.password")),1),a(ne,{id:"password",class:"my-2",modelValue:e(n).password,"onUpdate:modelValue":o[4]||(o[4]=r=>e(n).password=r),placeholder:"Password",required:!0},null,8,["modelValue"])])):d("",!0)],64)):d("",!0),e(M)?d("",!0):(c(),m("div",rs,[t("label",us,u(s.$t("messages.account.register")),1),h(t("input",{id:"creat-account","onUpdate:modelValue":o[5]||(o[5]=r=>e(n).createAccount=r),type:"checkbox",name:"creat-account"},null,512),[[R,e(n).createAccount]])]))])):d("",!0),e(i)==2?(c(),m(w,{key:1},[t("div",null,[t("h2",cs,u(s.$t("messages.billing.billingDetails")),1),a(ae,{modelValue:e(l).billing,"onUpdate:modelValue":o[6]||(o[6]=r=>e(l).billing=r),sameAsShippingAddress:e(n).shipToDifferentAddress},null,8,["modelValue","sameAsShippingAddress"])]),e(v).availableShippingMethods.length>0?(c(),m("label",ms,[t("span",null,u(s.$t("messages.billing.differentAddress")),1),h(t("input",{id:"shipToDifferentAddress","onUpdate:modelValue":o[7]||(o[7]=r=>e(n).shipToDifferentAddress=r),type:"checkbox",name:"shipToDifferentAddress"},null,512),[[R,e(n).shipToDifferentAddress]])])):d("",!0),a(L,{name:"scale-y",mode:"out-in"},{default:f(()=>[h(t("div",null,[t("h2",ds,u(s.$t("messages.general.shippingDetails")),1),a(le,{modelValue:e(l).shipping,"onUpdate:modelValue":o[8]||(o[8]=r=>e(l).shipping=r)},null,8,["modelValue"])],512),[[Z,e(n).shipToDifferentAddress]])]),_:1}),e(v).availableShippingMethods.length?(c(),m("div",ps,[t("h3",fs,u(s.$t("messages.general.shippingSelect")),1),a(ie,{options:e(v).availableShippingMethods[0].rates,"active-option":e(v).chosenShippingMethods[0]},null,8,["options","active-option"])])):d("",!0)],64)):d("",!0),e(i)==3?(c(),m(w,{key:2},[e(P).nodes.length?(c(),m("div",_s,[t("h2",gs,u(s.$t("messages.billing.paymentOptions")),1),a(re,{modelValue:e(n).paymentMethod,"onUpdate:modelValue":o[9]||(o[9]=r=>e(n).paymentMethod=r),class:"mb-4",paymentGateways:e(P)},null,8,["modelValue","paymentGateways"]),e(S)?h((c(),N(ue,{key:0,stripe:e(S),onUpdateElement:Q},null,8,["stripe"])),[[Z,e(n).paymentMethod.id=="stripe"]]):d("",!0)])):d("",!0)],64)):d("",!0),e(i)==4?(c(),m(w,{key:3},[t("div",null,[t("h2",hs,u(s.$t("messages.shop.orderNote"))+" ("+u(s.$t("messages.general.optional"))+")",1),h(t("textarea",{id:"order-note","onUpdate:modelValue":o[10]||(o[10]=r=>e(n).customerNote=r),name:"order-note",class:"w-full",rows:"4",placeholder:s.$t("messages.shop.orderNotePlaceholder")},null,8,vs),[[T,e(n).customerNote]])]),a(ce,null,{default:f(()=>[t("button",{class:"flex items-center justify-center w-full gap-3 p-3 mt-4 font-semibold text-center text-white rounded-lg shadow-md bg-primary hover:bg-primary-dark disabled:cursor-not-allowed disabled:bg-gray-400",disabled:e(F)},[D(u(e(I))+" ",1),e(E)?(c(),N($,{key:0,color:"#fff",size:"18"})):d("",!0)],8,ys)]),_:1})],64)):d("",!0)]),t("div",bs,[a(me,{class:"text-start bg-blue-100"},{default:f(()=>[a(G,{onClick:te,class:"rounded-full",disabled:e(i)===1},{icon:f(()=>[a(p,{icon:"ion:arrow-back"})]),_:1},8,["disabled"]),a(G,{onClick:se,disabled:e(i)===4},{icon:f(()=>[a(p,{icon:"ion:arrow-forward"})]),_:1},8,["disabled"])]),_:1})])],32))],64)):(c(),N($,{key:0,class:"m-auto"}))])}}});export{Ns as default};
