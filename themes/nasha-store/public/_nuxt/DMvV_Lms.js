import{d as te,x as se,y as oe,u as ae,X as ne,Y as le,s as w,T as ie,H as re,a6 as de,o as l,c as r,e,g as V,n as me,F as N,b as d,f as ce,i as s,t as i,w as k,j as S,k as ue,l as pe,Z as fe,$ as f,a0 as C,a1 as ge,h as m,a2 as O,a3 as j,a4 as z}from"./D2h1M-6X.js";import{_ as he}from"./DvU2Yq2X.js";import{u as _e,l as ye,_ as be,a as ve,b as xe,c as we,d as ke,e as Se}from"./CsQFPYKN.js";import{u as $e}from"./hrPMgQTE.js";import"./GQHXd0SH.js";import"./CTsXp8GV.js";import"./DM4cFtrS.js";import"./5Eo_AKUy.js";const Ae={class:"flex flex-col min-h-[600px]"},Ve={key:0,class:"flex flex-col items-center justify-center flex-1 mb-12"},Ce={class:"text-2xl font-bold mb-2"},De={class:"text-gray-400 mb-4"},Ie={class:"grid w-full max-w-2xl gap-8 checkout-form md:flex-1"},Ee={key:0},Me={class:"w-full mt-4"},Te={for:"email"},Ue={key:0,class:"mt-1 text-sm text-red-500"},Pe={class:"w-full mt-4"},Be={for:"username"},Ne={key:0,class:"w-full my-2"},Oe={for:"email"},je={key:1,class:"flex items-center gap-2 my-2"},ze={class:"w-full mb-3 text-2xl font-semibold"},qe={key:1,for:"shipToDifferentAddress",class:"flex items-center gap-2"},Ge={class:"mb-4 text-xl font-semibold"},Le={key:2},Re={class:"mb-4 text-xl font-semibold"},Ze={key:3,class:"mt-2 col-span-full"},Ye={class:"mb-4 text-xl font-semibold"},Fe={class:"mb-4 text-xl font-semibold"},He=["placeholder"],Ke=["disabled"],lt=te({__name:"checkout",async setup(Xe){var B;let v,D;const{t:_}=se(),{query:q}=oe(),{cart:g,isUpdatingCart:G,paymentGateways:I}=ae(),{customer:c,viewer:E}=ne(),{orderInput:a,isProcessingOrder:$,proccessCheckout:L}=_e(),M=((B=le().public)==null?void 0:B.STRIPE_PUBLISHABLE_KEY)||null,A=w($.value?_("messages.general.processing"):_("messages.shop.checkoutButton")),R=ie(()=>$.value||G.value||!a.value.paymentMethod),y=w(!1),x=M?([v,D]=re(()=>ye(M)),v=await v,D(),v):null;let T=w(null);const U=w(!1);de(async()=>{q.cancel_order&&window.close()});const Z=async()=>{var b;A.value=_("messages.general.processing");const{stripePaymentIntent:o}=await fe(),{clientSecret:t}=o;try{if(a.value.paymentMethod.id==="stripe"){const h=T.value.getElement("card"),{setupIntent:u}=await x.confirmCardSetup(t,{payment_method:{card:h}}),{source:p}=await x.createSource(h);p&&a.value.metaData.push({key:"_stripe_source_id",value:p.id}),u&&a.value.metaData.push({key:"_stripe_intent_id",value:u.id}),U.value=(u==null?void 0:u.status)==="succeeded"||!1,a.value.transactionId=((b=p==null?void 0:p.created)==null?void 0:b.toString())||new Date().getTime().toString()}}catch(h){console.error(h),A.value=_("messages.shop.placeOrder")}L(U.value)},Y=o=>{T.value=o},P=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/,F=o=>{o&&(y.value=!P.test(o))},H=o=>{o&&y.value&&(y.value=!P.test(o))};return $e({title:_("messages.shop.checkout")}),(o,t)=>{const b=me,h=ce,u=ue,p=he,K=be,X=ve,J=xe,Q=we,W=ke,ee=Se;return l(),r("div",Ae,[e(g)?(l(),r(N,{key:1},[e(g).isEmpty?(l(),r("div",Ve,[d(h,{name:"ion:cart-outline",size:"156",class:"opacity-25 mb-5"}),s("h2",Ce,i(o.$t("messages.shop.cartEmpty")),1),s("span",De,i(o.$t("messages.shop.addProductsInYourCart")),1),d(u,{to:"/products",class:"flex items-center justify-center gap-3 p-2 px-3 mt-4 font-semibold text-center text-white rounded-lg shadow-md bg-primary hover:bg-primary-dark"},{default:k(()=>[S(i(o.$t("messages.shop.browseOurProducts")),1)]),_:1})])):(l(),r("form",{key:1,class:"container flex flex-wrap items-start gap-8 my-16 justify-evenly lg:gap-20",onSubmit:pe(Z,["prevent"])},[s("div",Ie,[e(E)?m("",!0):(l(),r("div",Ee,[t[12]||(t[12]=s("h2",{class:"w-full mb-2 text-2xl font-semibold leading-none"},"Contact Information",-1)),t[13]||(t[13]=s("p",{class:"mt-1 text-sm text-gray-500"},[S("Already have an account? "),s("a",{href:"/my-account",class:"text-primary text-semibold"},"Log in"),S(".")],-1)),s("div",Me,[s("label",Te,i(o.$t("messages.billing.email")),1),f(s("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>e(c).billing.email=n),placeholder:"johndoe@email.com",type:"email",name:"email",class:ge({"has-error":e(y)}),onBlur:t[1]||(t[1]=n=>F(e(c).billing.email)),onInput:t[2]||(t[2]=n=>H(e(c).billing.email)),required:""},null,34),[[C,e(c).billing.email]]),d(O,{name:"scale-y",mode:"out-in"},{default:k(()=>[e(y)?(l(),r("div",Ue,"Invalid email address")):m("",!0)]),_:1})]),e(a).createAccount?(l(),r(N,{key:0},[s("div",Pe,[s("label",Be,i(o.$t("messages.account.username")),1),f(s("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>e(a).username=n),placeholder:"Username",type:"text",name:"username",required:""},null,512),[[C,e(a).username]])]),e(a).createAccount?(l(),r("div",Ne,[s("label",Oe,i(o.$t("messages.account.password")),1),d(p,{id:"password",class:"my-2",modelValue:e(a).password,"onUpdate:modelValue":t[4]||(t[4]=n=>e(a).password=n),placeholder:"Password",required:!0},null,8,["modelValue"])])):m("",!0)],64)):m("",!0),e(E)?m("",!0):(l(),r("div",je,[t[11]||(t[11]=s("label",{for:"creat-account"},"Create an account?",-1)),f(s("input",{id:"creat-account","onUpdate:modelValue":t[5]||(t[5]=n=>e(a).createAccount=n),type:"checkbox",name:"creat-account"},null,512),[[j,e(a).createAccount]])]))])),s("div",null,[s("h2",ze,i(o.$t("messages.billing.billingDetails")),1),d(K,{modelValue:e(c).billing,"onUpdate:modelValue":t[6]||(t[6]=n=>e(c).billing=n),sameAsShippingAddress:e(a).shipToDifferentAddress},null,8,["modelValue","sameAsShippingAddress"])]),e(g).availableShippingMethods.length>0?(l(),r("label",qe,[s("span",null,i(o.$t("messages.billing.differentAddress")),1),f(s("input",{id:"shipToDifferentAddress","onUpdate:modelValue":t[7]||(t[7]=n=>e(a).shipToDifferentAddress=n),type:"checkbox",name:"shipToDifferentAddress"},null,512),[[j,e(a).shipToDifferentAddress]])])):m("",!0),d(O,{name:"scale-y",mode:"out-in"},{default:k(()=>[f(s("div",null,[s("h2",Ge,i(o.$t("messages.general.shippingDetails")),1),d(X,{modelValue:e(c).shipping,"onUpdate:modelValue":t[8]||(t[8]=n=>e(c).shipping=n)},null,8,["modelValue"])],512),[[z,e(a).shipToDifferentAddress]])]),_:1}),e(g).availableShippingMethods.length?(l(),r("div",Le,[s("h3",Re,i(o.$t("messages.general.shippingSelect")),1),d(J,{options:e(g).availableShippingMethods[0].rates,"active-option":e(g).chosenShippingMethods[0]},null,8,["options","active-option"])])):m("",!0),e(I).nodes.length?(l(),r("div",Ze,[s("h2",Ye,i(o.$t("messages.billing.paymentOptions")),1),d(Q,{modelValue:e(a).paymentMethod,"onUpdate:modelValue":t[9]||(t[9]=n=>e(a).paymentMethod=n),class:"mb-4",paymentGateways:e(I)},null,8,["modelValue","paymentGateways"]),e(x)?f((l(),V(W,{key:0,stripe:e(x),onUpdateElement:Y},null,8,["stripe"])),[[z,e(a).paymentMethod.id=="stripe"]]):m("",!0)])):m("",!0),s("div",null,[s("h2",Fe,i(o.$t("messages.shop.orderNote"))+" ("+i(o.$t("messages.general.optional"))+")",1),f(s("textarea",{id:"order-note","onUpdate:modelValue":t[10]||(t[10]=n=>e(a).customerNote=n),name:"order-note",class:"w-full",rows:"4",placeholder:o.$t("messages.shop.orderNotePlaceholder")},null,8,He),[[C,e(a).customerNote]])])]),d(ee,null,{default:k(()=>[s("button",{class:"flex items-center justify-center w-full gap-3 p-3 mt-4 font-semibold text-center text-white rounded-lg shadow-md bg-primary hover:bg-primary-dark disabled:cursor-not-allowed disabled:bg-gray-400",disabled:e(R)},[S(i(e(A)),1),e($)?(l(),V(b,{key:0,color:"#fff",size:"18"})):m("",!0)],8,Ke)]),_:1})],32))],64)):(l(),V(b,{key:0,class:"m-auto"}))])}}});export{lt as default};
